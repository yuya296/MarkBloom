# Feature 012: Table Editor with Jspreadsheet CE

## 1. 目的
Markdown テーブル編集の基盤を Jspreadsheet CE へ置き換え、
「ヘッダを特別扱いしない」思想を保ちつつ、実用的な列操作 UI を提供する。

## 2. スコープ
### In scope
- Jspreadsheet CE を使ったテーブル編集の最小導入
- Jspreadsheet の本物のヘッダ/行番号を非表示
- Markdown の 1 行目を通常行として描画・編集
- 1 行目セルに列操作 UI を差し込み（ホバー時のみ表示）
- 列追加/削除/移動の最小操作を提供
- キーボード操作が UI に吸われない配慮

### Out of scope
- セル範囲選択や複数セル編集の高度化
- 列幅自動調整や表示美観の最適化
- Markdown 方言や特殊記法への拡張

## 3. 成果物
- `packages/webview-demo` で動く最小スパイク
- 操作仕様ドキュメント（本資料）

## 4. 採用方針（暫定）
- **Jspreadsheet CE** を採用
- **本物のヘッダ（A,B,C...）は非表示**
- **本物の行番号（1,2,3...）も非表示**
- **Markdown のヘッダ行は「1 行目の通常行」として描画・編集**
- **操作ボタン（列メニュー/ハンドル）は 1 行目セルの装飾として追加**
  - ホバー時のみ表示
  - フォーカスを奪わない

## 5. 最小スパイクで確認すべきこと
- `hideHeaders()` / `hideIndex()` の適用可否
- `freezeRows = 1` で 1 行目固定（ヘッダ行として常時表示）
- 1 行目セルのみ `render(...)` でメニューボタンを差し込み
- ボタンがキーボード移動を吸わないこと
  - `tabindex = -1`
  - `pointerdown` で伝播抑制

## 6. UI/操作仕様（案）
### 6.1 1 行目セルの拡張
- 1 行目の各セルに「列メニュー」ボタンを配置
- ホバー時のみ表示し、通常編集の邪魔にならないこと

### 6.2 列操作
- 列メニューから以下の操作を提供
  - Insert column left
  - Insert column right
  - Delete column
- 列移動はドラッグハンドルで実施
  - ハンドルは 1 行目セル内に表示
  - ドロップ位置が分かるラインを表示

### 6.3 フォーカス/入力
- ボタンはフォーカスを持たず、セルの編集状態を維持
- Tab/Arrow の移動がセルに対して機能する

## 7. 受け入れ条件（Acceptance Criteria）
- Jspreadsheet のヘッダ/行番号が非表示
- Markdown の 1 行目が通常行として編集できる
- 1 行目の UI から列追加/削除/移動ができる
- キーボード移動がボタンに奪われない

## 8. 依存
- Jspreadsheet CE
- `packages/webview-demo` の UI/テーマ

## 9. 留意事項
- Jspreadsheet のライセンス条件は CE の範囲に限定する
- CM6 ベース実装との共存方針は別途検討
